<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>


  <meta content="text/html; charset=ISO-8859-1" http-equiv="content-type"><title>Spherical Light</title></head><body>
<br>
<br>
<h1>Spherical Light<br>
</h1>
<br>
Jeremy Pronk 2008<br>
www.happiestdays.com<br>
<br>
<h2>Whats New</h2>
<h3>Version 6</h3>
Fixed crashing bug with interleaved light maps (race condition identified by Manfred Ernst)<br>
Fixed bug whereby low level light map would not be used for final gathering<br>
Added tint parameter<br>
Updated createSphericalLight to work with Maya 8.5 / mental ray 3.5.1.2<br>
<h3>Version 5</h3>
Added mental ray style shadows<br>
<h3>Version 4</h3>
Added second "low level" light map for use when trace depth exceeds a
specific level and/or when final gather rays are being evaluated<br>
<h3>Version 3</h3>
Added Linux build<br>
Added new compiler optimizations (win32)<br>
Added occlusion for shadows option<br>
Changed default for maxInterleavedShadowSamples to 64<br>
Changed to only read light maps generated by the new version of
lightMapGen,
beta4. <b>Not compatible with older
light map files.</b><br>
<h3>Version 2</h3>
Added "calculate shadows" parameter<br>
Added interleaved shadow sampling<br>
<h3>Version 1</h3>
Initial release<br>
<br>
<h2>Overview</h2>
<br>
Use light maps generated by lightMapGen in mental ray.<br>
<br>
Please see the lightMapGen documentation for additional information.<br>
<br>
<h2>Usage</h2>
See lightMapGen quick start.<br>
<br>
Turn on "Info Messages" under the Translation tab of Render Global
Settings to see the sphericalLight diagnostic messages.<br>
<br>
<br>

<h2>Example Results</h2>
<table border=1>

<tr><td><img src="a.jpg"></td><td><img src="b.jpg"></td><td><img src="c.jpg"></td></tr>
<tr>
<td><center>Grace probe 128 samples<br>8sec</center></td>
<td><center>Grace probe 128 samples<br>w/ final gathering<br>44sec</center></td>
<td><center>Grace probe 128 samples<br>w/ final gathering using low map 8 samples<br>11sec</center></td></tr>

</table>
<br>
<br>

<h2>Notes</h2>
<br>
<span style="font-weight: bold;">Light Map Orientation</span><br>
<br>
The lightMap is situated at the origin and oriented such that the theta
angle (x-axis if generated from lightMapGen) begins at positive X and
rotates towards positive Z. The phi angle (y-axis if generated from
lightMapGen) is the vertical, beginning from positive Y. sphericalLight
obeys it's parent transform, so if you want a different orientation
than the one described simply rotate and translate as required.<br>
<br>
<span style="font-weight: bold;">Interleaved Sampling</span><br>
<br>
Spherical light supports interleaved sampling of the shadow rays. <br>
<br>
<span style="font-weight: bold;">Making Shadows</span><br>
<br>
Their may be some confusion as to what technique to use for shadows.
Besides simply switching on shadowing you can use these
two basic rules of thumb:<br>
<ol>
  <li>If you are using a light map with a low sample count, <span style="font-weight: bold;">try using occlusion shadow sampling</span></li>
  <li>If you find you want to increasing the samples in your lightmap
because of shadow artifacts, <span style="font-weight: bold;">try
using
interleaved sampling</span>. (e.g. rather than using a light map with
128 samples, try 32 samples with 4 interleave levels)</li>
</ol>
<span style="font-weight: bold;">Final Gathering, Reflections and
Refractions</span><br>
<br>
These computational expensive procedures can be sped up by using an
alternate "low level" light map. See the <span style="font-weight: bold;">Level </span>and <span style="font-weight: bold;">Use Low Light Map for Final Gather </span>parameters.<br>
<br>
<br>
<h2>Parameters</h2>
<br>
<h3>Light Map Data File</h3>
Light map file.<br>
<br>
<h3>Type</h3>
Spot Lights - treats each light map sample as emanating from a single
location (e.g. equivalent to spot or point lights)<br>
Directional Lights - treats each light map sample as a light with
parallel rays<br>
<br>
<h3>Intensity</h3>
Gain applied to light map samples.<br>
<br>
<h3>Radius</h3>
World space size of the light map (sphere). <br>
<br>
<h3>Shadows</h3>
None - no shadows will be calculated<br>
Mental Ray - mental ray's standard shadowing will be used for each
sample<br>
Occlusion - an occlusion call will be used for each sample with the
cone angle set to the size of the sample in the light map<br>
Interleaved - a trace probe will be used for each interleaved sample
(i.e. multiple shadow rays for each sample), you must have an
interleaved light map for this to work<br>
<br>
<span style="font-weight: bold;">About Occlusion Shadows</span><br>
When enabled an occlusion style algorithm is used for shadow testing.
The occlusion cone size (i.e. area above the shading sample to check
for
occlusion) is set to the solid angle of the current sample in the light
map. Useful to get soft shadows from light maps with low sample counts
but still have the shadow softness related to the light map. To
visualize this area you can pass the <span style="font-style: italic;">writeDiagImages</span>
flag to lightMapGen. <span style="font-style: italic;">See the
lightMapGen documentation for more
information.</span><br>
If occlusion shadows are enabled the interleave settings below are
ignored. Interleave samples are still used but may not be as
appropriate when using occlusion shadows.<br>
<br>
<h3>Occlusion Shadow Samples</h3>
Number of occlusion samples. The occlusion shadow samples are divided
up between the light map samples, depending on a particular light map
samples area.<br>
<br>
<h3>Occlusion Min Softness</h3>
Increase this value if you dont want any sharp shadows. 1 = full
hemispherical sampling.<br>
<br>
<h3>Level</h3>
Operates the same as the <span style="font-weight: bold;">Level </span>parameter
for mental ray area lights. In the case of sphericalLight the <span style="font-weight: bold;">Light Map File Low</span> is used when the <span style="font-weight: bold;">Level </span>is triggered.<br>
<br>
<h3>Use Low Light Map for Finalgather<br>
</h3>
When enabled the <span style="font-weight: bold;">Light Map File Low</span>
will be used for finalgather rays.<br>
<br>
<h3>Shadows Low, Occlusion Shadow Samples
and Occlusion Min Softness Low<br>
</h3>
These params are the same as their non-Low counterparts but apply to
the low level lightmap <span style="font-weight: bold;">Light Map File
Low</span><br>
<br>
<h3>Max Interleaved Shadow Samples</h3>
This parameter can be used to restrict the number of shadow samples
when using an interleaved light map. E.g. if you load a map with 16
interleave levels but wish to use only 8.<br>
<br>
<h3>Interleaved Shadow Sampling Type</h3>
When "Max Interleaved Shadow Samples" is less than the number of
interleaved samples in the currently load map, this parameter specifics
how to choose which "Max Interleaved Shadow Samples" are used.<br>
<br>
0 - Random : chooses a random interleaved sample each time<br>
1 - mental ray : uses mental ray's sampling engine to choose the
interleaved sample<br>
<br>
<br>
<h2>Known Issues<br>
</h2>
<ul>
  <li>when using occlusion or interleaved shadows objects<span style="font-weight: bold;"> must be </span>visible
to raytracing for shadows to work<br>
  </li>
  <li>shadows calculations are not completely correct when using
directional (parallel)
light mode, objects outside the lights radius may unintentionally
occlude<br>
  </li>
  <li>does not work correctly with Maya materials, use mental ray
equivalents for now<br>
  </li>
</ul>
<br>
</body></html>